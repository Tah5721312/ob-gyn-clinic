// ====================================
// Prisma Schema - Ø¹ÙŠØ§Ø¯Ø© Ù†Ø³Ø§Ø¡ ÙˆÙˆÙ„Ø§Ø¯Ø© Ù…Ø¨Ø³Ø·Ø©
// Ù„Ù„Ø¹ÙŠØ§Ø¯Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© - Ø·Ø¨ÙŠØ¨ ÙˆØ§Ø­Ø¯ + Ø§Ø³ØªÙ‚Ø¨Ø§Ù„
// ====================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ====================================
// 1ï¸âƒ£ Ø§Ù„Ù…Ø±Ø¶Ù‰ (Patients)
// ====================================

model Patient {
  id            Int      @id @default(autoincrement())
  firstName     String   @db.VarChar(50)
  lastName      String   @db.VarChar(50)
  birthDate     DateTime @db.Date
  bloodType     String?  @db.VarChar(10)
  phone         String   @db.VarChar(15)
  phone2        String?  @db.VarChar(15)
  address       String?  @db.VarChar(200)
  maritalStatus String?  @db.VarChar(20)

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
  emergencyContactName     String? @db.VarChar(100)
  emergencyContactPhone    String? @db.VarChar(15)
  emergencyContactRelation String? @db.VarChar(50)

  registrationDate DateTime @default(now()) @db.Date
  isActive         Boolean  @default(true)
  notes            String?  @db.Text

  // Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·
  insuranceId Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  appointments     Appointment[]
  visits           MedicalVisit[]
  medicalHistory   MedicalHistory?
  pregnancyRecords PregnancyRecord[]
  diagnoses        Diagnosis[]
  insurances       Insurance[]       @relation("PatientInsurances")
  insurance        Insurance?        @relation("ActiveInsurance", fields: [insuranceId], references: [id])
  invoices         Invoice[]

  @@index([phone])
  @@index([firstName, lastName])
  @@index([isActive])
  @@index([insuranceId])
  @@map("patients")
}

// ====================================
// 1ï¸âƒ£1ï¸âƒ£ Ø§Ù„ØªØ£Ù…ÙŠÙ† (Insurance)
// ====================================

model Insurance {
  id               Int      @id @default(autoincrement())
  patientId        Int
  insuranceCompany String   @db.VarChar(100)
  policyNumber     String   @db.VarChar(100)
  expiryDate       DateTime @db.Date
  coverageDetails  String?  @db.Text
  isActive         Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patient        Patient   @relation("PatientInsurances", fields: [patientId], references: [id], onDelete: Cascade)
  activePatients Patient[] @relation("ActiveInsurance")

  @@index([patientId])
  @@index([isActive])
  @@index([expiryDate])
  @@map("insurances")
}

// ====================================
// 2ï¸âƒ£ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ (Doctors)
// ====================================

model Doctor {
  id             Int     @id @default(autoincrement())
  nationalId     String  @unique @db.VarChar(14)
  firstName      String  @db.VarChar(50)
  lastName       String  @db.VarChar(50)
  specialization String  @db.VarChar(100)
  licenseNumber  String  @unique @db.VarChar(50)
  phone          String  @db.VarChar(15)
  isActive       Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  user            User?
  workingSchedule WorkingSchedule[]
  appointments    Appointment[]
  visits          MedicalVisit[]
  templates       Template[]
  invoices        Invoice[]

  @@index([nationalId])
  @@index([licenseNumber])
  @@index([isActive])
  @@map("doctors")
}

// ====================================
// 2ï¸âƒ£1ï¸âƒ£ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† (Users)
// ====================================

model User {
  id           Int    @id @default(autoincrement())
  username     String @unique @db.VarChar(50)
  passwordHash String @db.VarChar(255)
  role         String @db.VarChar(20) // DOCTOR, RECEPTIONIST, ADMIN

  doctorId Int? @unique

  firstName String  @db.VarChar(50)
  lastName  String  @db.VarChar(50)
  email     String? @unique @db.VarChar(100)
  phone     String  @db.VarChar(15)

  isActive  Boolean   @default(true)
  lastLogin DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctor   Doctor?   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  payments Payment[]

  @@index([username])
  @@index([role])
  @@index([email])
  @@map("users")
}

// ====================================
// 3ï¸âƒ£ Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„
// ====================================

model WorkingSchedule {
  id                  Int      @id @default(autoincrement())
  doctorId            Int
  dayOfWeek           Int // 0=Ø§Ù„Ø£Ø­Ø¯ØŒ 6=Ø§Ù„Ø³Ø¨Øª
  dayName             String   @db.VarChar(20)
  startTime           DateTime @db.Time
  endTime             DateTime @db.Time
  slotDurationMinutes Int      @default(30)
  maxPatientsPerSlot  Int      @default(1)
  isActive            Boolean  @default(true)

  // Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
  breakStartTime DateTime? @db.Time // ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ø§Ø­Ø©
  breakEndTime   DateTime? @db.Time // ÙˆÙ‚Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø±Ø§Ø­Ø©

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId, dayOfWeek])
  @@index([doctorId, isActive])
  @@map("working_schedules")
}

// ====================================
// 4ï¸âƒ£ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Appointments)
// ====================================

model Appointment {
  id              Int      @id @default(autoincrement())
  patientId       Int
  doctorId        Int
  appointmentDate DateTime @db.Date
  appointmentTime DateTime @db.Time
  status          String   @default("BOOKED") @db.VarChar(20) // BOOKED, CANCELLED, COMPLETED
  durationMinutes Int      @default(30)
  visitReason     String?  @db.VarChar(100) // Ø³Ø¨Ø¨ Ø§Ù„Ø²ÙŠØ§Ø±Ø©: ÙƒØ´ÙØŒ Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ù…Ù„ØŒ Ø³ÙˆÙ†Ø§Ø±ØŒ Ø¥Ù„Ø®
  receptionNotes  String?  @db.Text // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„: "ØªØ¯Ø®Ù„ Ø¨Ø³Ø±Ø¹Ø©"ØŒ "Ù…Ø±ÙŠØ¶Ø© Ø­Ø³Ø§Ø³Ø©"ØŒ Ø¥Ù„Ø®
  notes           String?  @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patient Patient       @relation(fields: [patientId], references: [id])
  doctor  Doctor        @relation(fields: [doctorId], references: [id])
  visit   MedicalVisit?
  invoice Invoice?

  @@index([patientId])
  @@index([doctorId])
  @@index([appointmentDate, doctorId])
  @@index([status])
  @@map("appointments")
}

// ====================================
// 5ï¸âƒ£ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©
// ====================================

model MedicalVisit {
  id             Int       @id @default(autoincrement())
  appointmentId  Int       @unique
  patientId      Int
  doctorId       Int
  visitDate      DateTime  @db.Date
  visitStartTime DateTime?
  visitEndTime   DateTime?
  completedAt    DateTime?
  isDraft        Boolean   @default(true) // Ù…Ø³ÙˆØ¯Ø© - ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¯ÙƒØªÙˆØ± ÙØªØ­ ÙƒØ´Ù ÙˆØªØ±ÙƒÙ‡ Ù…Ø¤Ù‚ØªØ§Ù‹

  // Ø§Ù„Ø´ÙƒÙˆÙ‰ ÙˆØ§Ù„Ø£Ø¹Ø±Ø§Ø¶
  chiefComplaint String? @db.Text
  symptoms       String? @db.Text

  // Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ©
  weight                 Decimal? @db.Decimal(5, 2)
  bloodPressureSystolic  Int?
  bloodPressureDiastolic Int?
  temperature            Decimal? @db.Decimal(4, 2)
  pulse                  Int?

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø©
  examinationFindings String?   @db.Text
  treatmentPlan       String?   @db.Text
  recommendations     String?   @db.Text
  nextVisitDate       DateTime? @db.Date
  referredTo          String?   @db.VarChar(200) // Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù…Ø³ØªØ´ÙÙ‰/Ø·Ø¨ÙŠØ¨ Ø¢Ø®Ø±
  notes               String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  appointment       Appointment         @relation(fields: [appointmentId], references: [id])
  patient           Patient             @relation(fields: [patientId], references: [id])
  doctor            Doctor              @relation(fields: [doctorId], references: [id])
  diagnoses         Diagnosis[]
  pregnancyFollowup PregnancyFollowup[]
  prescriptions     Prescription[]
  invoice           Invoice?

  @@index([patientId])
  @@index([doctorId])
  @@index([visitDate])
  @@index([isDraft])
  @@map("medical_visits")
}

// ====================================
// 6ï¸âƒ£ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ
// ====================================

model MedicalHistory {
  id        Int @id @default(autoincrement())
  patientId Int @unique

  // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ Ø§Ù„Ø¹Ø§Ù…
  chronicDiseases    String? @db.Text
  previousSurgeries  String? @db.Text
  allergies          String? @db.Text
  currentMedications String? @db.Text
  familyHistory      String? @db.Text

  // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠ
  gynecologicalHistory   String?   @db.Text
  ageOfMenarche          Int?
  lastMenstrualPeriod    DateTime? @db.Date
  menstrualCycleLength   Int?
  menstrualNotes         String?   @db.Text // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©: Ø§Ù†ØªØ¸Ø§Ù…ØŒ ØªØ¯ÙÙ‚ØŒ Ø£Ù„Ù…ØŒ Ø¥Ù„Ø®
  contraceptionMethod    String?   @db.VarChar(100)
  contraceptionStartDate DateTime? @db.Date

  // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø¬Ø§Ø¨ÙŠ (GPAL)
  gravida        Int @default(0) // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø­Ù…Ù„
  para           Int @default(0) // Ø¹Ø¯Ø¯ Ø§Ù„ÙˆÙ„Ø§Ø¯Ø§Øª
  abortion       Int @default(0) // Ø¹Ø¯Ø¯ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¶
  livingChildren Int @default(0) // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
  sexualHistory      String? @db.Text
  smokingStatus      String? @db.VarChar(50)
  alcoholConsumption String? @db.VarChar(50)
  exerciseFrequency  String? @db.VarChar(50)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@map("medical_history")
}

// ====================================
// 7ï¸âƒ£ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ù…Ù„
// ====================================

model PregnancyRecord {
  id              Int       @id @default(autoincrement())
  patientId       Int
  pregnancyNumber Int // Ø±Ù‚Ù… Ø§Ù„Ø­Ù…Ù„
  lmpDate         DateTime  @db.Date // Ø¢Ø®Ø± Ø¯ÙˆØ±Ø© Ø´Ù‡Ø±ÙŠØ©
  eddDate         DateTime? @db.Date // ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙ„Ø§Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
  eddByUltrasound DateTime? @db.Date

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ„Ø§Ø¯Ø©
  deliveryDate             DateTime? @db.Date
  deliveryType             String?   @db.VarChar(50)
  gestationalAgeAtDelivery Decimal?  @db.Decimal(4, 1)
  deliveryMethod           String?   @db.VarChar(100)

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯
  babyGender String? @db.VarChar(10)

  medicationsDuringPregnancy String? @db.Text
  notes                      String? @db.Text
  isActive                   Boolean @default(true) // Ø­Ù…Ù„ Ø­Ø§Ù„ÙŠ Ø£Ù… Ø§Ù†ØªÙ‡Ù‰

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patient   Patient             @relation(fields: [patientId], references: [id])
  followups PregnancyFollowup[]

  @@unique([patientId, pregnancyNumber])
  @@index([patientId])
  @@index([lmpDate])
  @@index([eddDate])
  @@index([isActive])
  @@map("pregnancy_records")
}

// ====================================
// 8ï¸âƒ£ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ù…Ù„
// ====================================

model PregnancyFollowup {
  id          Int      @id @default(autoincrement())
  pregnancyId Int
  visitId     Int
  visitDate   DateTime @db.Date

  // Ø¹Ù…Ø± Ø§Ù„Ø­Ù…Ù„ (Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¯ÙˆØ±Ø©)
  gestationalAgeWeeks Decimal? @db.Decimal(3, 1)

  // Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ© Ù„Ù„Ø£Ù…
  maternalWeight Decimal? @db.Decimal(5, 2)
  weightGain     Decimal? @db.Decimal(5, 2)
  bloodPressure  String?  @db.VarChar(20)
  edema          String?  @db.VarChar(50)

  // Ø§Ù„ÙØ­ÙˆØµØ§Øª
  urineAnalysis   String?  @db.VarChar(200)
  bloodSugarLevel Decimal? @db.Decimal(5, 2)
  hemoglobinLevel Decimal? @db.Decimal(4, 2)

  // Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø³ÙˆÙ†Ø§Ø±
  ultrasoundFindings String? @db.Text
  placentalLocation  String? @db.VarChar(100)

  // Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª
  complications         String?   @db.Text
  medicationsPrescribed String?   @db.Text
  nextVisitDate         DateTime? @db.Date
  notes                 String?   @db.Text

  createdAt DateTime @default(now())

  pregnancy     PregnancyRecord @relation(fields: [pregnancyId], references: [id], onDelete: Cascade)
  visit         MedicalVisit    @relation(fields: [visitId], references: [id])
  prescriptions Prescription[]

  @@index([pregnancyId])
  @@index([visitId])
  @@index([visitDate])
  @@map("pregnancy_followup")
}

// ====================================
// 9ï¸âƒ£ Ø§Ù„ØªØ´Ø®ÙŠØµØ§Øª
// ====================================

model Diagnosis {
  id            Int      @id @default(autoincrement())
  visitId       Int
  patientId     Int
  diagnosisName String   @db.VarChar(200)
  diagnosisDate DateTime @default(now()) @db.Date
  isChronic     Boolean  @default(false)
  isHighRisk    Boolean  @default(false)
  notes         String?  @db.Text

  createdAt DateTime @default(now())

  visit   MedicalVisit @relation(fields: [visitId], references: [id])
  patient Patient      @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([visitId])
  @@index([diagnosisDate])
  @@index([isChronic])
  @@map("diagnoses")
}

// ====================================
// ğŸ”Ÿ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©
// ====================================

model Medication {
  id                Int      @id @default(autoincrement())
  medicationName    String   @db.VarChar(200) // Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡
  scientificName    String?  @db.VarChar(200) // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ù„Ù…ÙŠ
  form              String?  @db.VarChar(50) // Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ: Ø£Ù‚Ø±Ø§ØµØŒ ÙƒØ¨Ø³ÙˆÙ„Ø§ØªØŒ Ø´Ø±Ø§Ø¨ØŒ Ø¥Ù„Ø®
  pregnancyCategory String?  @db.VarChar(5) // A, B, C, D
  breastfeedingSafe String?  @db.VarChar(20) // SAFE, UNSAFE, CAUTION
  notes             String?  @db.Text // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
  sideEffects       String?  @db.Text
  price             Decimal? @db.Decimal(10, 2)

  isActive Boolean @default(true) // Ù…Ù‡Ù… Ø¹Ø´Ø§Ù† Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…ØªÙˆÙ‚ÙØ©

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([medicationName])
  @@index([form])
  @@index([isActive]) // Index Ø¬Ø¯ÙŠØ¯
  @@map("medications")
}

// ====================================
// 1ï¸âƒ£1ï¸âƒ£ Ø§Ù„Ø±ÙˆØ´ØªØ§Øª (Prescriptions)
// ====================================

model Prescription {
  id         Int     @id @default(autoincrement())
  visitId    Int? // Ù„Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
  followupId Int? // Ù„Ù…ØªØ§Ø¨Ø¹Ø§Øª Ø§Ù„Ø­Ù…Ù„
  notes      String? @db.Text

  createdAt DateTime @default(now())

  visit    MedicalVisit?      @relation(fields: [visitId], references: [id], onDelete: Cascade)
  followup PregnancyFollowup? @relation(fields: [followupId], references: [id], onDelete: Cascade)
  items    PrescriptionItem[]

  @@index([visitId])
  @@index([followupId])
  @@map("prescriptions")
}

model PrescriptionItem {
  id             Int     @id @default(autoincrement())
  prescriptionId Int
  medicationName String  @db.VarChar(200)
  dosage         String  @db.VarChar(100)
  frequency      String  @db.VarChar(100)
  duration       String  @db.VarChar(100)
  instructions   String? @db.Text

  prescription Prescription @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)

  @@index([prescriptionId])
  @@map("prescription_items")
}

// ====================================
// 1ï¸âƒ£2ï¸âƒ£ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© (Templates)
// ====================================

model Template {
  id           Int     @id @default(autoincrement())
  doctorId     Int
  templateType String  @db.VarChar(100) // free text: "Ø±ÙˆØ´ØªØ©"ØŒ "ØªØ´Ø®ÙŠØµ"ØŒ "Ø²ÙŠØ§Ø±Ø©"ØŒ Ø¥Ù„Ø®
  templateName String  @db.VarChar(200)
  category     String? @db.VarChar(100) // free text: "Ø­Ù…Ù„"ØŒ "Ø§Ù„ØªÙ‡Ø§Ø¨Ø§Øª"ØŒ Ø¥Ù„Ø® (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  content      String  @db.Text // free text
  isActive     Boolean @default(true)
  usageCount   Int     @default(0)
  isFavorite   Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId])
  @@index([doctorId, isFavorite])
  @@index([doctorId, usageCount])
  @@map("templates")
}

// ====================================
// 1ï¸âƒ£3ï¸âƒ£ Ø§Ù„ÙÙˆØ§ØªÙŠØ± (Invoices)
// ====================================

model Invoice {
  id            Int    @id @default(autoincrement())
  invoiceNumber String @unique @db.VarChar(50) // INV-2024-001

  // Ø§Ù„Ø±Ø¨Ø·
  visitId       Int? @unique
  appointmentId Int? @unique
  patientId     Int
  doctorId      Int

  invoiceDate DateTime  @default(now()) @db.Date
  dueDate     DateTime? @db.Date // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚

  // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº
  subtotal    Decimal @default(0) @db.Decimal(10, 2) // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…
  discount    Decimal @default(0) @db.Decimal(10, 2) // Ø§Ù„Ø®ØµÙ…
  totalAmount Decimal @db.Decimal(10, 2) // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

  // Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹
  paidAmount      Decimal @default(0) @db.Decimal(10, 2) // Ø§Ù„Ù…Ø¯ÙÙˆØ¹
  remainingAmount Decimal @db.Decimal(10, 2) // Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
  paymentStatus   String  @default("UNPAID") @db.VarChar(20) // UNPAID, PARTIAL, PAID

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
  notes           String?  @db.Text
  insuranceClaim  Boolean  @default(false) // Ù‡Ù„ ÙÙŠÙ‡ Ù…Ø·Ø§Ù„Ø¨Ø© ØªØ£Ù…ÙŠÙ†ØŸ
  insuranceAmount Decimal? @db.Decimal(10, 2) // Ù…Ø¨Ù„Øº Ø§Ù„ØªØ£Ù…ÙŠÙ†

  isCancelled  Boolean   @default(false)
  cancelledAt  DateTime?
  cancelReason String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  patient     Patient       @relation(fields: [patientId], references: [id])
  doctor      Doctor        @relation(fields: [doctorId], references: [id])
  visit       MedicalVisit? @relation(fields: [visitId], references: [id])
  appointment Appointment?  @relation(fields: [appointmentId], references: [id])

  items    InvoiceItem[] // Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
  payments Payment[] // Ø§Ù„Ø¯ÙØ¹Ø§Øª

  @@index([invoiceNumber])
  @@index([patientId])
  @@index([doctorId])
  @@index([invoiceDate])
  @@index([paymentStatus])
  @@index([isCancelled])
  @@map("invoices")
}

// ====================================
// 1ï¸âƒ£4ï¸âƒ£ Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Invoice Items)
// ====================================

model InvoiceItem {
  id        Int @id @default(autoincrement())
  invoiceId Int

  itemType    String  @db.VarChar(50) // CONSULTATION, ULTRASOUND, PROCEDURE, MEDICATION, LAB_TEST
  description String  @db.VarChar(200) // "ÙƒØ´Ù Ø¹Ø§Ø¯ÙŠ", "Ø³ÙˆÙ†Ø§Ø± 3D"
  quantity    Int     @default(1)
  unitPrice   Decimal @db.Decimal(10, 2) // Ø§Ù„Ø³Ø¹Ø± Ù„Ù„ÙˆØ­Ø¯Ø©
  totalPrice  Decimal @db.Decimal(10, 2) // quantity * unitPrice

  notes String? @db.Text

  createdAt DateTime @default(now())

  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([itemType])
  @@map("invoice_items")
}

// ====================================
// 1ï¸âƒ£5ï¸âƒ£ Ø§Ù„Ø¯ÙØ¹Ø§Øª (Payments)
// ====================================

model Payment {
  id        Int @id @default(autoincrement())
  invoiceId Int

  paymentNumber String   @unique @db.VarChar(50) // PAY-2024-001
  paymentDate   DateTime @default(now()) @db.Date
  paymentTime   DateTime @default(now()) @db.Time

  amount        Decimal @db.Decimal(10, 2) // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹
  paymentMethod String  @db.VarChar(50) // CASH, CARD, BANK_TRANSFER, INSURANCE

  // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹
  referenceNumber String? @db.VarChar(100) // Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ (Ù„Ù„ÙƒØ§Ø±Øª Ø£Ùˆ Ø§Ù„ØªØ­ÙˆÙŠÙ„)
  bankName        String? @db.VarChar(100) // Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ
  checkNumber     String? @db.VarChar(50) // Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ

  receivedById Int? // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„ÙŠ Ø§Ø³ØªÙ„Ù… Ø§Ù„ÙÙ„ÙˆØ³
  notes        String? @db.Text

  isRefunded   Boolean   @default(false)  //Ù…Ø³ØªØ±Ø¬Ø¹ Ù„Ù„Ø¯ÙØ¹
  refundedAt   DateTime?
  refundReason String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  invoice    Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  receivedBy User?   @relation(fields: [receivedById], references: [id])

  @@index([invoiceId])
  @@index([paymentDate])
  @@index([paymentMethod])
  @@index([isRefunded])
  @@index([receivedById])
  @@map("payments")
}
