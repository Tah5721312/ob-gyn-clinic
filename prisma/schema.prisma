// ====================================
// Prisma Schema - Ù†Ø¸Ø§Ù… Ø¹ÙŠØ§Ø¯Ø© Ù†Ø³Ø§Ø¡ ÙˆÙˆÙ„Ø§Ø¯Ø©
// Database: PostgreSQL / MySQL
// ====================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // Ø£Ùˆ "mysql"
}

// ====================================
// 1ï¸âƒ£ Ø§Ù„Ù…Ø±Ø¶Ù‰ (Patients)
// ====================================

model Patient {
  id            Int            @id @default(autoincrement())
  nationalId    String         @unique @db.VarChar(14)
  firstName     String         @db.VarChar(50)
  lastName      String         @db.VarChar(50)
  birthDate     DateTime       @db.Date
  bloodType     String?        @db.VarChar(10)
  phone         String         @db.VarChar(15)
  phone2        String?        @db.VarChar(15)
  email         String?        @db.VarChar(100)
  address       String?        @db.VarChar(200)
  city          String?        @db.VarChar(50)
  maritalStatus String?        @db.VarChar(20)
  occupation    String?        @db.VarChar(100)

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
  emergencyContactName     String? @db.VarChar(100)
  emergencyContactPhone    String? @db.VarChar(15)
  emergencyContactRelation String? @db.VarChar(50)

  registrationDate DateTime @default(now()) @db.Date
  isActive         Boolean  @default(true)
  notes            String?  @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy Int?

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  appointments     Appointment[]
  visits           MedicalVisit[]
  medicalHistory   MedicalHistory?
  pregnancyRecords PregnancyRecord[]
  diagnoses        Diagnosis[]
  prescriptions    Prescription[]
  labOrders        LabOrder[]
  radiologyOrders  RadiologyOrder[]
  surgeries        Surgery[]
  invoices         Invoice[]
  patientInsurance PatientInsurance[]

  @@index([nationalId])
  @@index([phone])
  @@index([firstName, lastName])
  @@index([isActive])
  @@index([registrationDate])
  @@map("patients")
}

// Enums moved to src/lib/enumdb.ts

// ====================================
// 2ï¸âƒ£ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ (Doctors)
// ====================================

model Doctor {
  id                Int     @id @default(autoincrement())
  nationalId        String  @unique @db.VarChar(14)
  firstName         String  @db.VarChar(50)
  lastName          String  @db.VarChar(50)
  specialization    String  @db.VarChar(100)
  subSpecialization String? @db.VarChar(100)
  licenseNumber     String  @unique @db.VarChar(50)
  phone             String  @db.VarChar(15)
  email             String? @db.VarChar(100)

  // Ø§Ù„Ø±Ø³ÙˆÙ…
  consultationFee Decimal  @db.Decimal(10, 2)
  followupFee     Decimal? @db.Decimal(10, 2)
  emergencyFee    Decimal? @db.Decimal(10, 2)
  surgeryBaseFee  Decimal? @db.Decimal(10, 2)

  yearsOfExperience Int?
  qualification     String? @db.VarChar(200)
  bio               String? @db.Text
  profileImage      String? @db.VarChar(500)
  isActive          Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  workingSchedule             WorkingSchedule[]
  leaves                      DoctorLeave[]
  appointments                Appointment[]
  visits                      MedicalVisit[]
  prescriptions               Prescription[]
  labOrders                   LabOrder[]
  radiologyOrders             RadiologyOrder[]
  surgeries                   Surgery[]
  surgeriesAsAnesthesiologist Surgery[]         @relation("Anesthesiologist")
  systemUser                  SystemUser?

  @@index([nationalId])
  @@index([licenseNumber])
  @@index([isActive])
  @@index([specialization])
  @@map("doctors")
}

// ====================================
// 3ï¸âƒ£ Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„
// ====================================

model WorkingSchedule {
  id                  Int      @id @default(autoincrement())
  doctorId            Int
  dayOfWeek           Int // 0=Ø§Ù„Ø£Ø­Ø¯ØŒ 6=Ø§Ù„Ø³Ø¨Øª
  dayName             String         @db.VarChar(20)
  startTime           DateTime @db.Time
  endTime             DateTime @db.Time
  slotDurationMinutes Int      @default(30)
  maxPatientsPerSlot  Int      @default(1)
  isActive            Boolean  @default(true)
  notes               String?  @db.VarChar(500)

  createdAt DateTime @default(now())

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId, dayOfWeek])
  @@index([doctorId, isActive])
  @@map("working_schedules")
}

// ====================================
// 4ï¸âƒ£ Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡
// ====================================

model DoctorLeave {
  id             Int       @id @default(autoincrement())
  doctorId       Int
  leaveStartDate DateTime  @db.Date
  leaveEndDate   DateTime  @db.Date
  leaveType      String       @db.VarChar(30)
  reason         String?   @db.VarChar(500)
  isApproved     Boolean   @default(false)
  approvedBy     Int?

  createdAt DateTime @default(now())

  doctor Doctor @relation(fields: [doctorId], references: [id])

  @@index([doctorId, leaveStartDate, leaveEndDate])
  @@index([leaveStartDate, leaveEndDate])
  @@index([isApproved])
  @@map("doctor_leaves")
}

// ====================================
// 5ï¸âƒ£ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Appointments)
// ====================================

model Appointment {
  id              Int               @id @default(autoincrement())
  patientId       Int
  doctorId        Int
  appointmentDate DateTime          @db.Date
  appointmentTime DateTime          @db.Time
  appointmentType String             @db.VarChar(30)
  status          String             @default("Ù…Ø­Ø¬ÙˆØ²") @db.VarChar(30)
  priority        String             @default("Ø¹Ø§Ø¯ÙŠ") @db.VarChar(20)
  durationMinutes Int               @default(30)

  cancellationReason String?   @db.VarChar(200)
  cancelledBy        Int?
  cancelledAt        DateTime?

  reminderSent   Boolean   @default(false)
  reminderSentAt DateTime?
  arrivalTime    DateTime?

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy Int?

  patient Patient       @relation(fields: [patientId], references: [id])
  doctor  Doctor        @relation(fields: [doctorId], references: [id])
  visit   MedicalVisit?

  @@index([patientId])
  @@index([doctorId])
  @@index([appointmentDate, doctorId])
  @@index([appointmentDate, appointmentTime])
  @@index([status])
  @@index([appointmentType])
  @@map("appointments")
}

// ====================================
// 6ï¸âƒ£ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©
// ====================================

model MedicalVisit {
  id             Int       @id @default(autoincrement())
  appointmentId  Int       @unique
  patientId      Int
  doctorId       Int
  visitDate      DateTime  @db.Date
  visitStartTime DateTime?
  visitEndTime   DateTime?

  // Ø§Ù„Ø´ÙƒÙˆÙ‰ ÙˆØ§Ù„Ø£Ø¹Ø±Ø§Ø¶
  chiefComplaint   String? @db.Text
  symptoms         String? @db.Text
  symptomsDuration String? @db.VarChar(100)

  // Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ©
  weight                 Decimal? @db.Decimal(5, 2)
  height                 Decimal? @db.Decimal(5, 2)
  bloodPressureSystolic  Int?
  bloodPressureDiastolic Int?
  temperature            Decimal? @db.Decimal(4, 2)
  pulse                  Int?
  respiratoryRate        Int?
  oxygenSaturation       Decimal? @db.Decimal(5, 2)

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø©
  visitType           String?     @db.VarChar(50)
  examinationFindings String?     @db.Text
  treatmentPlan       String?     @db.Text
  recommendations     String?     @db.Text
  nextVisitDate       DateTime?   @db.Date
  visitStatus         String      @default("Ø¬Ø§Ø±ÙŠØ©") @db.VarChar(30)

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  appointment       Appointment         @relation(fields: [appointmentId], references: [id])
  patient           Patient             @relation(fields: [patientId], references: [id])
  doctor            Doctor              @relation(fields: [doctorId], references: [id])
  diagnoses         Diagnosis[]
  prescriptions     Prescription[]
  labOrders         LabOrder[]
  radiologyOrders   RadiologyOrder[]
  pregnancyFollowup PregnancyFollowup[]
  surgeryFollowup   SurgeryFollowup[]
  invoices          Invoice[]

  @@index([patientId])
  @@index([doctorId])
  @@index([visitDate])
  @@map("medical_visits")
}

// ====================================
// 7ï¸âƒ£ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ
// ====================================

model MedicalHistory {
  id        Int @id @default(autoincrement())
  patientId Int @unique

  // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ Ø§Ù„Ø¹Ø§Ù…
  chronicDiseases    String? @db.Text
  previousSurgeries  String? @db.Text
  allergies          String? @db.Text
  currentMedications String? @db.Text
  familyHistory      String? @db.Text

  // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠ
  gynecologicalHistory     String?          @db.Text
  ageOfMenarche            Int?
  lastMenstrualPeriod      DateTime?        @db.Date
  menstrualCycleLength     Int?
  menstrualCycleRegularity String? @db.VarChar(30)
  menstrualFlow            String? @db.VarChar(20)
  dysmenorrhea             String?          @db.VarChar(50)
  contraceptionMethod      String?          @db.VarChar(100)
  contraceptionStartDate   DateTime?        @db.Date

  // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø¬Ø§Ø¨ÙŠ (GPAL)
  gravida        Int @default(0) // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø­Ù…Ù„
  para           Int @default(0) // Ø¹Ø¯Ø¯ Ø§Ù„ÙˆÙ„Ø§Ø¯Ø§Øª
  abortion       Int @default(0) // Ø¹Ø¯Ø¯ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¶
  livingChildren Int @default(0) // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
  sexualHistory      String? @db.Text
  smokingStatus      String? @db.VarChar(50)
  alcoholConsumption String? @db.VarChar(50)
  exerciseFrequency  String? @db.VarChar(50)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  updatedBy Int?

  patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@map("medical_history")
}

// ====================================
// 8ï¸âƒ£ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ù…Ù„
// ====================================

model PregnancyRecord {
  id              Int       @id @default(autoincrement())
  patientId       Int
  pregnancyNumber Int // Ø±Ù‚Ù… Ø§Ù„Ø­Ù…Ù„
  lmpDate         DateTime  @db.Date // Ø¢Ø®Ø± Ø¯ÙˆØ±Ø© Ø´Ù‡Ø±ÙŠØ©
  eddDate         DateTime? @db.Date // ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙ„Ø§Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
  eddByUltrasound DateTime? @db.Date

  conceptionMethod String?      @db.VarChar(30)
  pregnancyType    String?      @db.VarChar(30)
  pregnancyStatus  String       @db.VarChar(30)
  riskLevel        String?      @db.VarChar(20)

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ„Ø§Ø¯Ø©
  deliveryDate             DateTime? @db.Date
  deliveryType             String?   @db.VarChar(50)
  deliveryLocation         String?   @db.VarChar(100)
  gestationalAgeAtDelivery Decimal?  @db.Decimal(4, 1)
  deliveryMethod           String?   @db.VarChar(100)
  anesthesiaType           String?   @db.VarChar(50)

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯
  babyGender            String?     @db.VarChar(10)
  babyWeight            Decimal?    @db.Decimal(5, 3)
  babyLength            Decimal?    @db.Decimal(4, 1)
  babyHeadCircumference Decimal?    @db.Decimal(4, 1)
  apgarScore1min        Int?
  apgarScore5min        Int?
  babyStatus            String?     @db.VarChar(30)

  complications              String? @db.Text
  medicationsDuringPregnancy String? @db.Text
  notes                      String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patient         Patient             @relation(fields: [patientId], references: [id])
  followups       PregnancyFollowup[]
  radiologyOrders RadiologyOrder[]

  @@unique([patientId, pregnancyNumber])
  @@index([patientId])
  @@index([pregnancyStatus])
  @@index([lmpDate])
  @@index([eddDate])
  @@index([deliveryDate])
  @@map("pregnancy_records")
}

// ====================================
// 9ï¸âƒ£ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ù…Ù„
// ====================================

model PregnancyFollowup {
  id          Int      @id @default(autoincrement())
  pregnancyId Int
  visitId     Int
  visitDate   DateTime @db.Date
  visitNumber Int?

  // Ø¹Ù…Ø± Ø§Ù„Ø­Ù…Ù„
  gestationalAgeWeeks Decimal? @db.Decimal(3, 1)
  gestationalAgeDays  Int?

  // Ø§Ù„ÙØ­Øµ Ø§Ù„Ø³Ø±ÙŠØ±ÙŠ
  fundalHeight       Decimal?       @db.Decimal(4, 2)
  fetalHeartRate     Int?
  fetalMovement      String?     @db.VarChar(30)
  fetalPosition      String?        @db.VarChar(50)
  cervicalDilation   Decimal?       @db.Decimal(3, 1)
  cervicalEffacement Int?

  // Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ© Ù„Ù„Ø£Ù…
  maternalWeight Decimal? @db.Decimal(5, 2)
  weightGain     Decimal? @db.Decimal(5, 2)
  bloodPressure  String?  @db.VarChar(20)
  edema          String?  @db.VarChar(50)

  // Ø§Ù„ÙØ­ÙˆØµØ§Øª
  urineProtein    String?  @db.VarChar(50)
  urineGlucose    String?  @db.VarChar(50)
  urineAnalysis   String?  @db.VarChar(200)
  bloodSugarLevel Decimal? @db.Decimal(5, 2)
  hemoglobinLevel Decimal? @db.Decimal(4, 2)

  // Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø³ÙˆÙ†Ø§Ø±
  ultrasoundFindings   String?  @db.Text
  estimatedFetalWeight Decimal? @db.Decimal(6, 3)
  amnioticFluidIndex   Decimal? @db.Decimal(4, 2)
  placentalLocation    String?  @db.VarChar(100)
  placentalGrade       String?  @db.VarChar(20)

  // Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª
  complications         String?   @db.Text
  riskFactors           String?   @db.Text
  recommendations       String?   @db.Text
  medicationsPrescribed String?   @db.Text
  nextVisitDate         DateTime? @db.Date
  nextVisitType         String?   @db.VarChar(100)
  notes                 String?   @db.Text

  createdAt DateTime @default(now())

  pregnancy PregnancyRecord @relation(fields: [pregnancyId], references: [id], onDelete: Cascade)
  visit     MedicalVisit    @relation(fields: [visitId], references: [id])

  @@index([pregnancyId])
  @@index([visitId])
  @@index([visitDate])
  @@map("pregnancy_followup")
}

// ====================================
// ğŸ”Ÿ Ø§Ù„ØªØ´Ø®ÙŠØµØ§Øª
// ====================================

model Diagnosis {
  id              Int           @id @default(autoincrement())
  visitId         Int
  patientId       Int
  icdCode         String?       @db.VarChar(10)
  diagnosisName   String        @db.VarChar(200)
  diagnosisNameEn String?       @db.VarChar(200)
  diagnosisType   String       @db.VarChar(30)
  severity        String?      @db.VarChar(20)
  diagnosisDate   DateTime      @default(now()) @db.Date
  isChronic       Boolean       @default(false)
  isResolved      Boolean       @default(false)
  resolutionDate  DateTime?     @db.Date
  notes           String?       @db.Text

  createdAt DateTime @default(now())
  createdBy Int?

  visit   MedicalVisit @relation(fields: [visitId], references: [id])
  patient Patient      @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([visitId])
  @@index([icdCode])
  @@index([diagnosisDate])
  @@index([isChronic])
  @@map("diagnoses")
}

// ====================================
// 1ï¸âƒ£1ï¸âƒ£ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©
// ====================================

model Medication {
  id             Int             @id @default(autoincrement())
  medicationName String          @db.VarChar(200)
  genericName    String?         @db.VarChar(200)
  scientificName String?         @db.VarChar(200)
  category       String?         @db.VarChar(100)
  subcategory    String?         @db.VarChar(100)
  form           String?         @db.VarChar(30)
  strength       String?         @db.VarChar(50)
  unit           String?         @db.VarChar(20)
  manufacturer   String?         @db.VarChar(200)

  // Ø§Ù„Ø£Ù…Ø§Ù†
  pregnancyCategory String?  @db.VarChar(5)
  breastfeedingSafe Boolean?
  sideEffects       String?  @db.Text
  contraindications String?  @db.Text
  drugInteractions  String?  @db.Text
  storageConditions String?  @db.VarChar(200)

  price    Decimal? @db.Decimal(10, 2)
  isActive Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  prescriptionDetails PrescriptionDetail[]

  @@index([medicationName])
  @@index([category])
  @@index([isActive])
  @@map("medications")
}

// ====================================
// 1ï¸âƒ£2ï¸âƒ£ Ø§Ù„Ø±ÙˆØ´ØªØ§Øª
// ====================================

model Prescription {
  id                  Int       @id @default(autoincrement())
  visitId             Int
  patientId           Int
  doctorId            Int
  prescriptionDate    DateTime  @default(now()) @db.Date
  isEmergency         Boolean   @default(false)
  isChronicMedication Boolean   @default(false)
  validUntil          DateTime? @db.Date
  refillsAllowed      Int       @default(0)
  refillsUsed         Int       @default(0)
  pharmacyNotes       String?   @db.Text
  notes               String?   @db.Text

  createdAt DateTime @default(now())

  visit   MedicalVisit         @relation(fields: [visitId], references: [id])
  patient Patient              @relation(fields: [patientId], references: [id])
  doctor  Doctor               @relation(fields: [doctorId], references: [id])
  details PrescriptionDetail[]

  @@index([patientId])
  @@index([doctorId])
  @@index([prescriptionDate])
  @@index([visitId])
  @@index([isChronicMedication])
  @@map("prescriptions")
}

model PrescriptionDetail {
  id              Int              @id @default(autoincrement())
  prescriptionId  Int
  medicationId    Int
  dosage          String           @db.VarChar(100)
  frequency       String           @db.VarChar(100)
  frequencyPerDay Int?
  route           String?      @db.VarChar(30)
  timing          String?          @db.VarChar(200)
  durationDays    Int?
  startDate       DateTime?        @db.Date
  endDate         DateTime?        @db.Date
  totalQuantity   Int?
  instructions    String?          @db.Text
  isAsNeeded      Boolean          @default(false)

  prescription Prescription @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
  medication   Medication   @relation(fields: [medicationId], references: [id])

  @@index([prescriptionId])
  @@map("prescription_details")
}

// ====================================
// 1ï¸âƒ£3ï¸âƒ£ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù…Ù„ÙŠØ©
// ====================================

model LabTest {
  id                      Int         @id @default(autoincrement())
  testCode                String      @unique @db.VarChar(20)
  testName                String      @db.VarChar(200)
  testNameEn              String?     @db.VarChar(200)
  testCategory            String      @db.VarChar(30)
  normalRangeMin          Decimal?    @db.Decimal(10, 2)
  normalRangeMax          Decimal?    @db.Decimal(10, 2)
  normalRangeText         String?     @db.VarChar(100)
  unit                    String?     @db.VarChar(50)
  sampleType              String?     @db.VarChar(50)
  fastingRequired         Boolean     @default(false)
  preparationInstructions String?     @db.Text
  turnaroundTimeHours     Int?
  price                   Decimal?    @db.Decimal(10, 2)
  isActive                Boolean     @default(true)

  createdAt DateTime @default(now())

  results LabResult[]

  @@index([testCode])
  @@index([testCategory])
  @@index([isActive])
  @@map("lab_tests")
}

model LabOrder {
  id                 Int            @id @default(autoincrement())
  visitId            Int
  patientId          Int
  doctorId           Int
  orderDate          DateTime       @default(now()) @db.Date
  orderReason        String?        @db.VarChar(500)
  priority           String         @default("Ø¹Ø§Ø¯ÙŠ") @db.VarChar(20)
  status             String         @default("Ù…Ø¹Ù„Ù‚") @db.VarChar(30)
  sampleCollectedAt  DateTime?
  sampleReceivedAt   DateTime?
  expectedResultDate DateTime?      @db.Date
  labName            String?        @db.VarChar(100)
  externalLabOrderId String?        @db.VarChar(100)
  notes              String?        @db.Text

  createdAt DateTime @default(now())

  visit   MedicalVisit @relation(fields: [visitId], references: [id])
  patient Patient      @relation(fields: [patientId], references: [id])
  doctor  Doctor       @relation(fields: [doctorId], references: [id])
  results LabResult[]

  @@index([patientId])
  @@index([status])
  @@index([orderDate])
  @@index([doctorId])
  @@index([visitId])
  @@map("lab_orders")
}

model LabResult {
  id               Int           @id @default(autoincrement())
  orderId          Int
  testId           Int
  resultValue      String?       @db.VarChar(200)
  resultNumeric    Decimal?      @db.Decimal(10, 2)
  resultStatus     String?      @db.VarChar(30)
  resultDate       DateTime?     @db.Date
  resultTime       DateTime?
  performedBy      String?       @db.VarChar(100)
  verifiedBy       String?       @db.VarChar(100)
  isCritical       Boolean       @default(false)
  criticalNotified Boolean       @default(false)
  notes            String?       @db.Text

  createdAt DateTime @default(now())

  order LabOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  test  LabTest  @relation(fields: [testId], references: [id])

  @@index([orderId])
  @@index([testId])
  @@index([resultDate])
  @@index([resultStatus])
  @@index([isCritical])
  @@map("lab_results")
}

// ====================================
// 1ï¸âƒ£4ï¸âƒ£ Ø§Ù„Ø£Ø´Ø¹Ø© ÙˆØ§Ù„Ø³ÙˆÙ†Ø§Ø±
// ====================================

model RadiologyOrder {
  id          Int           @id @default(autoincrement())
  visitId     Int
  patientId   Int
  doctorId    Int
  pregnancyId Int?
  examType    String         @db.VarChar(30)
  examArea    String?       @db.VarChar(100)
  examReason  String?       @db.VarChar(500)
  orderDate   DateTime      @default(now()) @db.Date
  examDate    DateTime?     @db.Date
  examTime    DateTime?

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ù…Ù„
  gestationalAgeAtScan Decimal? @db.Decimal(3, 1)

  // Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  findings     String?         @db.Text
  impression   String?         @db.Text
  measurements String?         @db.Text
  status       String          @default("Ù…Ø¹Ù„Ù‚") @db.VarChar(30)

  // Ø§Ù„Ù…Ù„ÙØ§Øª
  imagePath    String? @db.VarChar(500)
  reportPath   String? @db.VarChar(500)
  dicomStudyId String? @db.VarChar(100)
  performedBy  String? @db.VarChar(100)
  reportedBy   String? @db.VarChar(100)
  notes        String? @db.Text

  createdAt DateTime @default(now())

  visit     MedicalVisit     @relation(fields: [visitId], references: [id])
  patient   Patient          @relation(fields: [patientId], references: [id])
  doctor    Doctor           @relation(fields: [doctorId], references: [id])
  pregnancy PregnancyRecord? @relation(fields: [pregnancyId], references: [id])

  @@index([patientId])
  @@index([pregnancyId])
  @@index([orderDate])
  @@index([status])
  @@index([doctorId])
  @@index([visitId])
  @@map("radiology_orders")
}

// ====================================
// 1ï¸âƒ£5ï¸âƒ£ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¬Ø±Ø§Ø­ÙŠØ©
// ====================================

model Surgery {
  id                 Int         @id @default(autoincrement())
  patientId          Int
  doctorId           Int
  anesthesiologistId Int?
  surgeryName        String      @db.VarChar(200)
  surgeryType        String      @db.VarChar(30)
  surgeryCategory    String?     @db.VarChar(100)

  // Ø§Ù„ØªØ®Ø·ÙŠØ·
  plannedDate             DateTime? @db.Date
  scheduledDate           DateTime  @db.Date
  scheduledTime           DateTime?
  expectedDurationMinutes Int?

  // Ø§Ù„ØªÙ†ÙÙŠØ°
  actualSurgeryDate     DateTime? @db.Date
  actualStartTime       DateTime?
  actualEndTime         DateTime?
  actualDurationMinutes Int?

  // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
  preOpDiagnosis   String?         @db.VarChar(500)
  postOpDiagnosis  String?         @db.VarChar(500)
  procedureDetails String?         @db.Text
  anesthesiaType   String?         @db.VarChar(30)
  incisionType     String?         @db.VarChar(100)
  surgicalApproach String?         @db.VarChar(100)

  // Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  surgicalFindings    String? @db.Text
  specimensSent       String? @db.Text
  bloodLossMl         Int?
  transfusionRequired Boolean @default(false)
  complications       String? @db.Text

  // Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
  postOpInstructions    String? @db.Text
  medicationsPrescribed String? @db.Text
  followupSchedule      String? @db.VarChar(500)
  expectedRecoveryDays  Int?

  // Ø§Ù„Ø­Ø§Ù„Ø©
  status             String         @db.VarChar(30)
  cancellationReason String?       @db.VarChar(500)

  // Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø·Ø¨ÙŠ
  assistingDoctors String? @db.Text
  nursingStaff     String? @db.Text
  operatingRoom    String? @db.VarChar(50)
  notes            String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patient          Patient           @relation(fields: [patientId], references: [id])
  doctor           Doctor            @relation(fields: [doctorId], references: [id])
  anesthesiologist Doctor?           @relation("Anesthesiologist", fields: [anesthesiologistId], references: [id])
  followups        SurgeryFollowup[]

  @@index([patientId])
  @@index([doctorId])
  @@index([scheduledDate])
  @@index([status])
  @@index([surgeryType])
  @@map("surgeries")
}

// ====================================
// 1ï¸âƒ£6ï¸âƒ£ Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¬Ø±Ø§Ø­Ø©
// ====================================

model SurgeryFollowup {
  id                   Int            @id @default(autoincrement())
  surgeryId            Int
  visitId              Int?
  followupDate         DateTime       @db.Date
  daysPostSurgery      Int?
  woundCondition       String?        @db.VarChar(100)
  painLevel            Int? // 0-10
  complications        String?        @db.Text
  healingStatus        String?        @db.VarChar(20)
  suturesRemoved       Boolean        @default(false)
  suturesRemovalDate   DateTime?      @db.Date
  medicationsContinued String?        @db.Text
  recommendations      String?        @db.Text
  nextFollowupDate     DateTime?      @db.Date
  notes                String?        @db.Text

  createdAt DateTime @default(now())

  surgery Surgery       @relation(fields: [surgeryId], references: [id])
  visit   MedicalVisit? @relation(fields: [visitId], references: [id])

  @@index([surgeryId])
  @@index([visitId])
  @@index([followupDate])
  @@map("surgery_followup")
}

// ====================================
// 1ï¸âƒ£7ï¸âƒ£ Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±
// ====================================

model Service {
  id              Int             @id @default(autoincrement())
  serviceCode     String          @unique @db.VarChar(20)
  serviceName     String          @db.VarChar(200)
  serviceCategory String          @db.VarChar(30)
  description     String?         @db.VarChar(500)
  basePrice       Decimal         @db.Decimal(10, 2)
  insurancePrice  Decimal?        @db.Decimal(10, 2)
  durationMinutes Int?
  isTaxable       Boolean         @default(true)
  taxPercentage   Decimal         @default(14) @db.Decimal(5, 2)
  isActive        Boolean         @default(true)

  createdAt DateTime @default(now())

  invoiceDetails InvoiceDetail[]

  @@index([serviceCode])
  @@index([serviceCategory])
  @@index([isActive])
  @@map("services")
}

// ====================================
// 1ï¸âƒ£8ï¸âƒ£ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
// ====================================

model Invoice {
  id            Int       @id @default(autoincrement())
  invoiceNumber String    @unique @db.VarChar(50)
  patientId     Int
  visitId       Int?
  invoiceDate   DateTime  @default(now()) @db.Date
  dueDate       DateTime? @db.Date

  // Ø§Ù„Ù…Ø¨Ø§Ù„Øº
  subtotalAmount        Decimal @db.Decimal(10, 2)
  discountPercentage    Decimal @default(0) @db.Decimal(5, 2)
  discountAmount        Decimal @default(0) @db.Decimal(10, 2)
  discountReason        String? @db.VarChar(200)
  taxAmount             Decimal @default(0) @db.Decimal(10, 2)
  totalAmount           Decimal @db.Decimal(10, 2)
  insuranceCoverage     Decimal @default(0) @db.Decimal(10, 2)
  patientResponsibility Decimal @db.Decimal(10, 2)
  netAmount             Decimal @db.Decimal(10, 2)

  // Ø§Ù„Ø­Ø§Ù„Ø©
  paymentStatus   String         @default("ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹") @db.VarChar(30)
  paidAmount      Decimal       @default(0) @db.Decimal(10, 2)
  remainingAmount Decimal?      @db.Decimal(10, 2)

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†
  insuranceId          Int?
  insuranceClaimNumber String? @db.VarChar(100)
  billingNotes         String? @db.Text
  notes                String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy Int?

  patient   Patient           @relation(fields: [patientId], references: [id])
  visit     MedicalVisit?     @relation(fields: [visitId], references: [id])
  insurance InsuranceCompany? @relation(fields: [insuranceId], references: [id])
  details   InvoiceDetail[]
  payments  Payment[]

  @@index([patientId])
  @@index([invoiceDate])
  @@index([paymentStatus])
  @@index([invoiceNumber])
  @@index([insuranceId])
  @@map("invoices")
}

model InvoiceDetail {
  id             Int      @id @default(autoincrement())
  invoiceId      Int
  serviceId      Int?
  itemType       String      @db.VarChar(30)
  description    String   @db.VarChar(200)
  quantity       Int      @default(1)
  unitPrice      Decimal  @db.Decimal(10, 2)
  discountAmount Decimal  @default(0) @db.Decimal(10, 2)
  taxAmount      Decimal  @default(0) @db.Decimal(10, 2)
  totalPrice     Decimal  @db.Decimal(10, 2)
  notes          String?  @db.VarChar(500)

  invoice Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  service Service? @relation(fields: [serviceId], references: [id])

  @@index([invoiceId])
  @@map("invoice_details")
}

// ====================================
// 1ï¸âƒ£9ï¸âƒ£ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
// ====================================

model Payment {
  id            Int           @id @default(autoincrement())
  paymentNumber String?       @unique @db.VarChar(50)
  invoiceId     Int
  paymentDate   DateTime      @default(now()) @db.Date
  paymentTime   DateTime      @default(now())
  paymentAmount Decimal       @db.Decimal(10, 2)
  paymentMethod String           @db.VarChar(30)

  // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹
  referenceNumber String?   @db.VarChar(100)
  cardLast4Digits String?   @db.VarChar(4)
  bankName        String?   @db.VarChar(100)
  checkNumber     String?   @db.VarChar(50)
  checkDate       DateTime? @db.Date

  // Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
  processedBy     Int?
  receiptNumber   String? @db.VarChar(50)
  isRefund        Boolean @default(false)
  refundReason    String? @db.VarChar(500)
  parentPaymentId Int?
  notes           String? @db.VarChar(500)

  createdAt DateTime @default(now())

  invoice       Invoice   @relation(fields: [invoiceId], references: [id])
  parentPayment Payment?  @relation("PaymentRefund", fields: [parentPaymentId], references: [id])
  refunds       Payment[] @relation("PaymentRefund")

  @@index([invoiceId])
  @@index([paymentDate])
  @@index([paymentNumber])
  @@index([paymentMethod])
  @@map("payments")
}

// ====================================
// 2ï¸âƒ£0ï¸âƒ£ Ø´Ø±ÙƒØ§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†
// ====================================

model InsuranceCompany {
  id            Int     @id @default(autoincrement())
  companyCode   String  @unique @db.VarChar(20)
  companyName   String  @db.VarChar(200)
  companyNameEn String? @db.VarChar(200)
  contactPerson String? @db.VarChar(100)
  phone         String? @db.VarChar(15)
  phone2        String? @db.VarChar(15)
  email         String? @db.VarChar(100)
  website       String? @db.VarChar(200)
  address       String? @db.VarChar(200)
  city          String? @db.VarChar(50)

  // Ø´Ø±ÙˆØ· Ø§Ù„ØªØºØ·ÙŠØ©
  coveragePercentage  Decimal? @db.Decimal(5, 2)
  copayAmount         Decimal? @db.Decimal(10, 2)
  deductibleAmount    Decimal? @db.Decimal(10, 2)
  maxCoveragePerVisit Decimal? @db.Decimal(10, 2)
  maxCoverageAnnual   Decimal? @db.Decimal(10, 2)
  approvalRequired    Boolean  @default(true)

  // Ø§Ù„ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©
  paymentTerms      String?   @db.VarChar(200)
  paymentCycleDays  Int?
  contractStartDate DateTime? @db.Date
  contractEndDate   DateTime? @db.Date
  isActive          Boolean   @default(true)
  notes             String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patientInsurance PatientInsurance[]
  invoices         Invoice[]

  @@map("insurance_companies")
}

// ====================================
// 2ï¸âƒ£1ï¸âƒ£ ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶Ù‰
// ====================================

model PatientInsurance {
  id                       Int       @id @default(autoincrement())
  patientId                Int
  insuranceId              Int
  policyNumber             String    @db.VarChar(100)
  memberId                 String?   @db.VarChar(100)
  groupNumber              String?   @db.VarChar(100)
  policyHolderName         String?   @db.VarChar(100)
  relationshipToHolder     String?   @db.VarChar(50)
  startDate                DateTime  @db.Date
  endDate                  DateTime? @db.Date
  coverageType             String?   @db.VarChar(100)
  coverageDetails          String?   @db.Text
  preauthorizationRequired Boolean   @default(true)
  isPrimary                Boolean   @default(true)
  isActive                 Boolean   @default(true)
  verificationDate         DateTime? @db.Date
  verifiedBy               Int?
  notes                    String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  patient   Patient          @relation(fields: [patientId], references: [id])
  insurance InsuranceCompany @relation(fields: [insuranceId], references: [id])

  @@index([patientId])
  @@index([insuranceId])
  @@index([policyNumber])
  @@index([isActive])
  @@index([isPrimary])
  @@map("patient_insurance")
}

// ====================================
// 2ï¸âƒ£2ï¸âƒ£ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
// ====================================

model Staff {
  id                    Int            @id @default(autoincrement())
  employeeNumber        String         @unique @db.VarChar(20)
  nationalId            String         @unique @db.VarChar(14)
  firstName             String         @db.VarChar(50)
  lastName              String         @db.VarChar(50)
  position              String         @db.VarChar(30)
  department            String?        @db.VarChar(100)
  phone                 String         @db.VarChar(15)
  email                 String?        @db.VarChar(100)
  address               String?        @db.VarChar(200)
  hireDate              DateTime       @db.Date
  terminationDate       DateTime?      @db.Date
  employmentType        String         @db.VarChar(30)
  salary                Decimal?       @db.Decimal(10, 2)
  salaryCurrency        String         @default("EGP") @db.VarChar(3)
  workingHoursPerWeek   Int?
  emergencyContactName  String?        @db.VarChar(100)
  emergencyContactPhone String?        @db.VarChar(15)
  isActive              Boolean        @default(true)
  notes                 String?        @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  systemUser SystemUser?

  @@index([employeeNumber])
  @@index([nationalId])
  @@index([position])
  @@index([isActive])
  @@index([department])
  @@map("staff")
}

// ====================================
// 2ï¸âƒ£3ï¸âƒ£ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø±
// ====================================

model Permission {
  id             Int     @id @default(autoincrement())
  permissionName String  @unique @db.VarChar(100)
  permissionCode String  @unique @db.VarChar(50)
  description    String? @db.VarChar(500)
  module         String? @db.VarChar(50)
  isActive       Boolean @default(true)

  roles RolePermission[]

  @@index([permissionCode])
  @@index([module])
  @@index([isActive])
  @@map("permissions")
}

model Role {
  id          Int     @id @default(autoincrement())
  roleName    String  @unique @db.VarChar(100)
  roleCode    String  @unique @db.VarChar(50)
  description String? @db.VarChar(500)
  isActive    Boolean @default(true)

  createdAt DateTime @default(now())

  permissions RolePermission[]
  users       SystemUser[]

  @@index([roleCode])
  @@index([isActive])
  @@map("roles")
}

model RolePermission {
  id           Int      @id @default(autoincrement())
  roleId       Int
  permissionId Int
  grantedAt    DateTime @default(now())
  grantedBy    Int?

  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id])

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
  @@map("role_permissions")
}

// ====================================
// 2ï¸âƒ£4ï¸âƒ£ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
// ====================================

model SystemUser {
  id                  Int       @id @default(autoincrement())
  username            String    @unique @db.VarChar(50)
  passwordHash        String    @db.VarChar(200)
  passwordSalt        String?   @db.VarChar(100)
  email               String?   @unique @db.VarChar(100)
  userType            String       @db.VarChar(30)
  roleId              Int?
  doctorId            Int?      @unique
  staffId             Int?      @unique
  isActive            Boolean   @default(true)
  mustChangePassword  Boolean   @default(false)
  failedLoginAttempts Int       @default(0)
  accountLocked       Boolean   @default(false)
  lockedUntil         DateTime?
  lastLogin           DateTime?
  lastPasswordChange  DateTime?
  passwordExpiryDate  DateTime? @db.Date

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  role   Role?   @relation(fields: [roleId], references: [id])
  doctor Doctor? @relation(fields: [doctorId], references: [id])
  staff  Staff?  @relation(fields: [staffId], references: [id])

  auditLogs AuditLog[]

  @@index([username])
  @@index([email])
  @@index([userType])
  @@index([isActive])
  @@index([roleId])
  @@map("system_users")
}

// ====================================
// 2ï¸âƒ£5ï¸âƒ£ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª (Audit Log)
// ====================================

model AuditLog {
  id              Int        @id @default(autoincrement())
  userId          Int?
  actionType      String        @db.VarChar(30)
  tableName       String?    @db.VarChar(100)
  recordId        Int?
  oldValue        String?    @db.Text
  newValue        String?    @db.Text
  ipAddress       String?    @db.VarChar(45)
  userAgent       String?    @db.VarChar(500)
  actionTimestamp DateTime   @default(now())

  user SystemUser? @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([tableName, recordId])
  @@index([actionTimestamp])
  @@index([actionType])
  @@map("audit_log")
}

// All enums moved to src/lib/enumdb.ts
